#!/usr/bin/env python

import os

from coverage.cmdline import main as coverage_main
from coveralls import cli as coveralls_cli
import get_profile_stats
from test_server import get_server_path


odoo_full = os.environ.get("ODOO_REPO", "odoo/odoo")
odoo_version = os.environ.get("VERSION")
travis_home = os.environ.get("HOME", "~/")
server_path = get_server_path(odoo_full, odoo_version, travis_home)

if os.environ.get('TESTS', '0') == '1':
    print "Print cProfile sorted by index 0:"
    get_profile_stats.print_stats(
        filter_fnames=[travis_home,],
        exclude_fnames=[server_path, 'odoo-profiler'],
        sort_index=0,
        limit=30,
    )
    print "Print cProfile sorted by index 3:"
    get_profile_stats.print_stats(
        filter_fnames=[travis_home,],
        exclude_fnames=[server_path, 'odoo-profiler'],
        sort_index=3,
        limit=30,
    )
    coverage_main(["report", "--show-missing"])
    exit(coveralls_cli.main(argv=None))
